!function(r,f){"object"==typeof exports&&"undefined"!=typeof module?f(exports):"function"==typeof define&&define.amd?define(["exports"],f):f((r=r||self).SVDJS={})}(this,function(r){"use strict";r.SVD=function(r,f,o,t,e){if(f=void 0===f||f,o=void 0===o||o,e=1e-64/(t=t||Math.pow(2,-52)),!r)throw new TypeError("Matrix a is not defined");var i,a,n,s,h,M,l,d,p,u,b,w,q,y=r[0].length,v=r.length;if(v<y)throw new TypeError("Invalid matrix: m < n");var c,x,m=[],S=[],k=[];for(i=b=d=0;i<v;i++)S[i]=new Array(y).fill(0);for(i=0;i<y;i++)k[i]=new Array(y).fill(0);for(c=new Array(y).fill(0),i=0;i<v;i++)for(a=0;a<y;a++)S[i][a]=r[i][a];for(i=0;i<y;i++){for(m[i]=d,u=0,s=i+1,a=i;a<v;a++)u+=Math.pow(S[a][i],2);if(u<e)d=0;else for(p=(l=S[i][i])*(d=l<0?Math.sqrt(u):-Math.sqrt(u))-u,S[i][i]=l-d,a=s;a<y;a++){for(u=0,n=i;n<v;n++)u+=S[n][i]*S[n][a];for(l=u/p,n=i;n<v;n++)S[n][a]=S[n][a]+l*S[n][i]}for(c[i]=d,u=0,a=s;a<y;a++)u+=Math.pow(S[i][a],2);if(u<e)d=0;else{for(p=(l=S[i][i+1])*(d=l<0?Math.sqrt(u):-Math.sqrt(u))-u,S[i][i+1]=l-d,a=s;a<y;a++)m[a]=S[i][a]/p;for(a=s;a<v;a++){for(u=0,n=s;n<y;n++)u+=S[a][n]*S[i][n];for(n=s;n<y;n++)S[a][n]=S[a][n]+u*m[n]}}b<(w=Math.abs(c[i])+Math.abs(m[i]))&&(b=w)}if(o)for(i=y-1;0<=i;i--){if(0!==d){for(p=S[i][i+1]*d,a=s;a<y;a++)k[a][i]=S[i][a]/p;for(a=s;a<y;a++){for(u=0,n=s;n<y;n++)u+=S[i][n]*k[n][a];for(n=s;n<y;n++)k[n][a]=k[n][a]+u*k[n][i]}}for(a=s;a<y;a++)k[i][a]=0,k[a][i]=0;k[i][i]=1,d=m[i],s=i}if(f)for(i=y-1;0<=i;i--){for(s=i+1,d=c[i],a=s;a<y;a++)S[i][a]=0;if(0!==d){for(p=S[i][i]*d,a=s;a<y;a++){for(u=0,n=s;n<v;n++)u+=S[n][i]*S[n][a];for(l=u/p,n=i;n<v;n++)S[n][a]=S[n][a]+l*S[n][i]}for(a=i;a<v;a++)S[a][i]=S[a][i]/d}else for(a=i;a<v;a++)S[a][i]=0;S[i][i]=S[i][i]+1}for(t*=b,n=y-1;0<=n;n--)for(var A=0;A<50;A++){for(x=!1,s=n;0<=s;s--){if(Math.abs(m[s])<=t){x=!0;break}if(Math.abs(c[s-1])<=t)break}if(!x)for(M=0,h=s-(u=1),i=s;i<n+1&&(l=u*m[i],m[i]=M*m[i],!(Math.abs(l)<=t));i++)if(d=c[i],c[i]=Math.sqrt(l*l+d*d),M=d/(p=c[i]),u=-l/p,f)for(a=0;a<v;a++)w=S[a][h],q=S[a][i],S[a][h]=w*M+q*u,S[a][i]=-w*u+q*M;if(q=c[n],s===n){if(q<0&&(c[n]=-q,o))for(a=0;a<y;a++)k[a][n]=-k[a][n];break}for(b=c[s],l=(((w=c[n-1])-q)*(w+q)+((d=m[n-1])-(p=m[n]))*(d+p))/(2*p*w),d=Math.sqrt(l*l+1),l=((b-q)*(b+q)+p*(w/(l<0?l-d:l+d)-p))/b,i=s+(u=M=1);i<n+1;i++){if(d=m[i],w=c[i],p=u*d,d*=M,q=Math.sqrt(l*l+p*p),l=b*(M=l/(m[i-1]=q))+d*(u=p/q),d=-b*u+d*M,p=w*u,w*=M,o)for(a=0;a<y;a++)b=k[a][i-1],q=k[a][i],k[a][i-1]=b*M+q*u,k[a][i]=-b*u+q*M;if(q=Math.sqrt(l*l+p*p),l=(M=l/(c[i-1]=q))*d+(u=p/q)*w,b=-u*d+M*w,f)for(a=0;a<v;a++)w=S[a][i-1],q=S[a][i],S[a][i-1]=w*M+q*u,S[a][i]=-w*u+q*M}m[s]=0,m[n]=l,c[n]=b}for(i=0;i<y;i++)c[i]<t&&(c[i]=0);return{u:S,q:c,v:k}},r.VERSION="1.0.1",Object.defineProperty(r,"__esModule",{value:!0})});
